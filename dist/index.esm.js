/*
*
* Mp4Player.js v0.1.0
* Copyright (c) 2024-8-1 Ezviz-OpenBiz
* Released under MIT the License.
*
*/
import t,{Video as e}from"@ezuikit/player-base";import n from"@ezuikit/utils-collect";function r(t,e){return t===e||t!=t&&e!=e}function o(t,e){for(var n=t.length;n--;)if(r(t[n][0],e))return n;return-1}var i=Array.prototype.splice;function a(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}a.prototype.clear=function(){this.__data__=[],this.size=0},a.prototype.delete=function(t){var e=this.__data__,n=o(e,t);return!(n<0)&&(n==e.length-1?e.pop():i.call(e,n,1),--this.size,!0)},a.prototype.get=function(t){var e=this.__data__,n=o(e,t);return n<0?void 0:e[n][1]},a.prototype.has=function(t){return o(this.__data__,t)>-1},a.prototype.set=function(t,e){var n=this.__data__,r=o(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};var u="object"==typeof global&&global&&global.Object===Object&&global,s="object"==typeof self&&self&&self.Object===Object&&self,c=u||s||Function("return this")(),l=c.Symbol,p=Object.prototype,f=p.hasOwnProperty,v=p.toString,d=l?l.toStringTag:void 0;var h=Object.prototype.toString;var y="[object Null]",_="[object Undefined]",b=l?l.toStringTag:void 0;function g(t){return null==t?void 0===t?_:y:b&&b in Object(t)?function(t){var e=f.call(t,d),n=t[d];try{t[d]=void 0;var r=!0}catch(t){}var o=v.call(t);return r&&(e?t[d]=n:delete t[d]),o}(t):function(t){return h.call(t)}(t)}function m(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var j="[object AsyncFunction]",$="[object Function]",O="[object GeneratorFunction]",w="[object Proxy]";function x(t){if(!m(t))return!1;var e=g(t);return e==$||e==O||e==j||e==w}var P,z=c["__core-js_shared__"],A=(P=/[^.]+$/.exec(z&&z.keys&&z.keys.IE_PROTO||""))?"Symbol(src)_1."+P:"";var T=Function.prototype.toString;var k=/^\[object .+?Constructor\]$/,E=Function.prototype,L=Object.prototype,S=E.toString,C=L.hasOwnProperty,F=RegExp("^"+S.call(C).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function M(t){return!(!m(t)||(e=t,A&&A in e))&&(x(t)?F:k).test(function(t){if(null!=t){try{return T.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t));var e}function I(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return M(n)?n:void 0}var N=I(c,"Map"),U=I(Object,"create");var B=Object.prototype.hasOwnProperty;var V=Object.prototype.hasOwnProperty;function R(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function W(t,e){var n,r,o=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?o["string"==typeof e?"string":"hash"]:o.map}function D(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}R.prototype.clear=function(){this.__data__=U?U(null):{},this.size=0},R.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},R.prototype.get=function(t){var e=this.__data__;if(U){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return B.call(e,t)?e[t]:void 0},R.prototype.has=function(t){var e=this.__data__;return U?void 0!==e[t]:V.call(e,t)},R.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=U&&void 0===e?"__lodash_hash_undefined__":e,this},D.prototype.clear=function(){this.size=0,this.__data__={hash:new R,map:new(N||a),string:new R}},D.prototype.delete=function(t){var e=W(this,t).delete(t);return this.size-=e?1:0,e},D.prototype.get=function(t){return W(this,t).get(t)},D.prototype.has=function(t){return W(this,t).has(t)},D.prototype.set=function(t,e){var n=W(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};function H(t){var e=this.__data__=new a(t);this.size=e.size}H.prototype.clear=function(){this.__data__=new a,this.size=0},H.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},H.prototype.get=function(t){return this.__data__.get(t)},H.prototype.has=function(t){return this.__data__.has(t)},H.prototype.set=function(t,e){var n=this.__data__;if(n instanceof a){var r=n.__data__;if(!N||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new D(r)}return n.set(t,e),this.size=n.size,this};var q=function(){try{var t=I(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();function G(t,e,n){"__proto__"==e&&q?q(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function J(t,e,n){(void 0!==n&&!r(t[e],n)||void 0===n&&!(e in t))&&G(t,e,n)}var K=function(t,e,n){for(var r=-1,o=Object(t),i=n(t),a=i.length;a--;){var u=i[++r];if(!1===e(o[u],u,o))break}return t},Q="object"==typeof exports&&exports&&!exports.nodeType&&exports,X=Q&&"object"==typeof module&&module&&!module.nodeType&&module,Y=X&&X.exports===Q?c.Buffer:void 0;Y&&Y.allocUnsafe;var Z=c.Uint8Array;function tt(t,e){var n,r,o=(n=t.buffer,r=new n.constructor(n.byteLength),new Z(r).set(new Z(n)),r);return new t.constructor(o,t.byteOffset,t.length)}var et=Object.create,nt=function(){function t(){}return function(e){if(!m(e))return{};if(et)return et(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();var rt,ot,it=(rt=Object.getPrototypeOf,ot=Object,function(t){return rt(ot(t))}),at=Object.prototype;function ut(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||at)}function st(t){return null!=t&&"object"==typeof t}function ct(t){return st(t)&&"[object Arguments]"==g(t)}var lt=Object.prototype,pt=lt.hasOwnProperty,ft=lt.propertyIsEnumerable,vt=ct(function(){return arguments}())?ct:function(t){return st(t)&&pt.call(t,"callee")&&!ft.call(t,"callee")},dt=Array.isArray,ht=9007199254740991;function yt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=ht}function _t(t){return null!=t&&yt(t.length)&&!x(t)}var bt="object"==typeof exports&&exports&&!exports.nodeType&&exports,gt=bt&&"object"==typeof module&&module&&!module.nodeType&&module,mt=gt&&gt.exports===bt?c.Buffer:void 0,jt=(mt?mt.isBuffer:void 0)||function(){return!1},$t="[object Object]",Ot=Function.prototype,wt=Object.prototype,xt=Ot.toString,Pt=wt.hasOwnProperty,zt=xt.call(Object);var At={};At["[object Float32Array]"]=At["[object Float64Array]"]=At["[object Int8Array]"]=At["[object Int16Array]"]=At["[object Int32Array]"]=At["[object Uint8Array]"]=At["[object Uint8ClampedArray]"]=At["[object Uint16Array]"]=At["[object Uint32Array]"]=!0,At["[object Arguments]"]=At["[object Array]"]=At["[object ArrayBuffer]"]=At["[object Boolean]"]=At["[object DataView]"]=At["[object Date]"]=At["[object Error]"]=At["[object Function]"]=At["[object Map]"]=At["[object Number]"]=At["[object Object]"]=At["[object RegExp]"]=At["[object Set]"]=At["[object String]"]=At["[object WeakMap]"]=!1;var Tt="object"==typeof exports&&exports&&!exports.nodeType&&exports,kt=Tt&&"object"==typeof module&&module&&!module.nodeType&&module,Et=kt&&kt.exports===Tt&&u.process,Lt=function(){try{var t=kt&&kt.require&&kt.require("util").types;return t||Et&&Et.binding&&Et.binding("util")}catch(t){}}(),St=Lt&&Lt.isTypedArray,Ct=St?function(t){return function(e){return t(e)}}(St):function(t){return st(t)&&yt(t.length)&&!!At[g(t)]};function Ft(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}var Mt=Object.prototype.hasOwnProperty;function It(t,e,n){var o=t[e];Mt.call(t,e)&&r(o,n)&&(void 0!==n||e in t)||G(t,e,n)}var Nt=9007199254740991,Ut=/^(?:0|[1-9]\d*)$/;function Bt(t,e){var n=typeof t;return!!(e=null==e?Nt:e)&&("number"==n||"symbol"!=n&&Ut.test(t))&&t>-1&&t%1==0&&t<e}function Vt(t,e){var n=dt(t),r=!n&&vt(t),o=!n&&!r&&jt(t),i=!n&&!r&&!o&&Ct(t),a=n||r||o||i,u=a?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],s=u.length;for(var c in t)a&&("length"==c||o&&("offset"==c||"parent"==c)||i&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Bt(c,s))||u.push(c);return u}var Rt=Object.prototype.hasOwnProperty;function Wt(t){if(!m(t))return function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}(t);var e=ut(t),n=[];for(var r in t)("constructor"!=r||!e&&Rt.call(t,r))&&n.push(r);return n}function Dt(t){return _t(t)?Vt(t):Wt(t)}function Ht(t){return function(t,e,n,r){var o=!n;n||(n={});for(var i=-1,a=e.length;++i<a;){var u=e[i],s=void 0;void 0===s&&(s=t[u]),o?G(n,u,s):It(n,u,s)}return n}(t,Dt(t))}function qt(t,e,n,r,o,i,a){var u=Ft(t,n),s=Ft(e,n),c=a.get(s);if(c)J(t,n,c);else{var l,p=i?i(u,s,n+"",t,e,a):void 0,f=void 0===p;if(f){var v=dt(s),d=!v&&jt(s),h=!v&&!d&&Ct(s);p=s,v||d||h?dt(u)?p=u:st(l=u)&&_t(l)?p=function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}(u):d?(f=!1,p=s.slice()):h?(f=!1,p=tt(s)):p=[]:function(t){if(!st(t)||g(t)!=$t)return!1;var e=it(t);if(null===e)return!0;var n=Pt.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&xt.call(n)==zt}(s)||vt(s)?(p=u,vt(u)?p=Ht(u):m(u)&&!x(u)||(p=function(t){return"function"!=typeof t.constructor||ut(t)?{}:nt(it(t))}(s))):f=!1}f&&(a.set(s,p),o(p,s,r,i,a),a.delete(s)),J(t,n,p)}}function Gt(t,e,n,r,o){t!==e&&K(e,(function(i,a){if(o||(o=new H),m(i))qt(t,e,a,n,Gt,r,o);else{var u=r?r(Ft(t,a),i,a+"",t,e,o):void 0;void 0===u&&(u=i),J(t,a,u)}}),Dt)}function Jt(t){return t}var Kt=Math.max;var Qt=q?function(t,e){return q(t,"toString",{configurable:!0,enumerable:!1,value:(n=e,function(){return n}),writable:!0});var n}:Jt,Xt=Date.now;var Yt=function(t){var e=0,n=0;return function(){var r=Xt(),o=16-(r-n);if(n=r,o>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}(Qt);function Zt(t,e){return Yt(function(t,e,n){return e=Kt(void 0===e?t.length-1:e,0),function(){for(var r=arguments,o=-1,i=Kt(r.length-e,0),a=Array(i);++o<i;)a[o]=r[e+o];o=-1;for(var u=Array(e+1);++o<e;)u[o]=r[o];return u[e]=n(a),function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}(t,this,u)}}(t,e,Jt),t+"")}var te,ee=(te=function(t,e,n){Gt(t,e,n)},Zt((function(t,e){var n=-1,o=e.length,i=o>1?e[o-1]:void 0,a=o>2?e[2]:void 0;for(i=te.length>3&&"function"==typeof i?(o--,i):void 0,a&&function(t,e,n){if(!m(n))return!1;var o=typeof e;return!!("number"==o?_t(n)&&Bt(e,n.length):"string"==o&&e in n)&&r(n[e],t)}(e[0],e[1],a)&&(i=o<3?void 0:i,o=1),t=Object(t);++n<o;){var u=e[n];u&&te(t,u,n,i)}return t}))),ne={clsPrefix:"ezui-mp4",autoPlay:!0,volume:.5,width:600,height:400,disableContextmenu:!0,controls:!1,name:"mp4",loggerOptions:{name:"MP4"}};var re=function(){function t(){}return t.init=function(e){t.collect=new n(e)},t.send=function(e,n){var r,o;null==(o=t.collect)||null==(r=o.send)||r.call(o,{action:e,logInfo:n})},t.updateParams=function(e){t.collect.updateExtendsInfo(e)},t}();function oe(t,e,n){return e&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(t.prototype,e),t}function ie(t,e){return ie=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ie(t,e)}var ae=function(t){function n(e){var r;return void 0===e&&(e={}),(r=t.call(this,ee(ne,e))||this).name="Mp4Player",re.init({url:"https://log.ys7.com/statistics.do/opensdk_ezuikit",forbidden:r.options.disableCollect,extendsInfo:{protocol:"mp4",v:"0.1.0",url:r.options.url}}),re.send(1,{name:"constructor"}),r._videoClassName=r.options.clsPrefix+"-video",r._containerClassName=r.options.clsPrefix+"-container",r.logger.log("Mp4Player version: ",n.version),r.logger.log("Mp4Player options: ",r.options),r._volume=+(r.options.volume||0),r._render(),r._registerEvent(),r}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ie(t,e)}(n,t);var r=n.prototype;return r.play=function(t){var e,n;return null==(e=this.logger)||e.log("[play]"),null==(n=this.event)||n.emit("play"),re.send(50,{name:"play"}),this.$video?("string"==typeof t&&t&&(this.$video.src=t,this.options.url=t,this._pause()),this.$video.play()):Promise.resolve()},r.pause=function(){var t,e;null==(t=this.logger)||t.log("[pause]"),null==(e=this.event)||e.emit("pause"),re.send(50,{name:"pause"}),this._pause()},r._pause=function(){this.$video&&this.playing&&this.$video.pause()},r.setVolume=function(t){var e;this.$video&&(t=+t,isNaN(t)||t>1||t<0||"number"!=typeof t?null==(e=this.logger)||e.warn("volume value "+t+" is not within 0~1!"):(this.$video.muted&&t>0?this.$video.muted=!1:0===t&&(this.$video.muted=!0),this._volume=t,this.$video.volume=t))},r._render=function(){this.$video||(this.$video=new e(this.$container,this.options).$video,this.$video.classList.add(this._videoClassName),this.options.url&&(this.$video.src=this.options.url),this.$container.classList.add(this._containerClassName),this.$container.innerHTML="",this.$container.appendChild(this.$video),this.event.emit("rendered"))},r._registerEvent=function(){var t;(t=this).$video&&(t.$video.addEventListener("loadeddata",(function(e){t.event.emit("loadeddata"),t.event.emit("mediaInfo",{data:{height:e.target.videoHeight,width:e.target.videoWidth,vcodec:"",acodec:"",duration:e.target.duration}})})),t.$video.addEventListener("volumechange",(function(){t.event.emit("volumechange",{data:t.$video.volume})})),t.$video.addEventListener("seeking",(function(){t.event.emit("seeking",{data:t.$video.currentTime})})),t.$video.addEventListener("timeupdate",(function(){try{var e,n=null==(e=t.$video)?void 0:e.currentTime;t.event.emit("timeupdate",{data:n})}catch(t){}})),t.$video.addEventListener("error",(function(){var e;null==(e=t.event)||e.emit("error",{data:t.$video.error})})),["ended","abort","seeked","waiting","canplay","progress"].forEach((function(e){t.$video.addEventListener(e,(function(){t.event.emit(e)}))})))},r.destroy=function(){var e,n;re.send(50,{name:"destroy"}),this.$video&&(this._pause(),null==(e=this.logger)||e.log("[destroy]"),null==(n=this.event)||n.emit("destroy"),this.$container&&(this.$container.classList.remove(this._containerClassName),this.$container.innerHTML="",this.$container=null),this.$video&&(this.$video=null),t.prototype.destroy.call(this))},r.getVersion=function(){return re.send(50,{name:"getVersion"}),"0.1.0"},n.supportType=function(t){if(re.send(50,{name:"supportType",options:t}),"mp4"===t.type)return!0;if(t.url){var e=t.url;e.startsWith("http://")||e.startsWith("https://")||(e=/^\/\//.test(e)?"http:"+e:location.origin+location.pathname+e);try{return/\.mp4$/i.test(new URL(e).pathname)}catch(t){}}return!1},oe(n,[{key:"playing",get:function(){return this.$video&&!this.$video.paused}},{key:"volume",get:function(){return this._volume},set:function(t){this.setVolume(t)}},{key:"currentTime",get:function(){return this.$video.currentTime},set:function(t){this.$video.currentTime=t}},{key:"duration",get:function(){return this.$video.duration}}]),n}(t);ae.version="0.1.0";export{ae as default};
