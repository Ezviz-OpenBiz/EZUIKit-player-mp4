/*
*
* Mp4Player.js v0.1.0
* Copyright (c) 2024-8-1 Ezviz-OpenBiz
* Released under MIT the License.
*
*/
"use strict";var t=require("@ezuikit/player-base"),e=require("@ezuikit/utils-collect");function n(t,e){return t===e||t!=t&&e!=e}function r(t,e){for(var r=t.length;r--;)if(n(t[r][0],e))return r;return-1}var o=Array.prototype.splice;function i(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}i.prototype.clear=function(){this.__data__=[],this.size=0},i.prototype.delete=function(t){var e=this.__data__,n=r(e,t);return!(n<0)&&(n==e.length-1?e.pop():o.call(e,n,1),--this.size,!0)},i.prototype.get=function(t){var e=this.__data__,n=r(e,t);return n<0?void 0:e[n][1]},i.prototype.has=function(t){return r(this.__data__,t)>-1},i.prototype.set=function(t,e){var n=this.__data__,o=r(n,t);return o<0?(++this.size,n.push([t,e])):n[o][1]=e,this};var a="object"==typeof global&&global&&global.Object===Object&&global,u="object"==typeof self&&self&&self.Object===Object&&self,s=a||u||Function("return this")(),c=s.Symbol,l=Object.prototype,p=l.hasOwnProperty,f=l.toString,v=c?c.toStringTag:void 0;var d=Object.prototype.toString;var h="[object Null]",y="[object Undefined]",_=c?c.toStringTag:void 0;function b(t){return null==t?void 0===t?y:h:_&&_ in Object(t)?function(t){var e=p.call(t,v),n=t[v];try{t[v]=void 0;var r=!0}catch(t){}var o=f.call(t);return r&&(e?t[v]=n:delete t[v]),o}(t):function(t){return d.call(t)}(t)}function g(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var m="[object AsyncFunction]",j="[object Function]",$="[object GeneratorFunction]",O="[object Proxy]";function w(t){if(!g(t))return!1;var e=b(t);return e==j||e==$||e==m||e==O}var x,P=s["__core-js_shared__"],z=(x=/[^.]+$/.exec(P&&P.keys&&P.keys.IE_PROTO||""))?"Symbol(src)_1."+x:"";var A=Function.prototype.toString;var T=/^\[object .+?Constructor\]$/,k=Function.prototype,E=Object.prototype,L=k.toString,S=E.hasOwnProperty,C=RegExp("^"+L.call(S).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function F(t){return!(!g(t)||(e=t,z&&z in e))&&(w(t)?C:T).test(function(t){if(null!=t){try{return A.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t));var e}function M(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return F(n)?n:void 0}var I=M(s,"Map"),N=M(Object,"create");var U=Object.prototype.hasOwnProperty;var V=Object.prototype.hasOwnProperty;function B(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function q(t,e){var n,r,o=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?o["string"==typeof e?"string":"hash"]:o.map}function R(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}B.prototype.clear=function(){this.__data__=N?N(null):{},this.size=0},B.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},B.prototype.get=function(t){var e=this.__data__;if(N){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return U.call(e,t)?e[t]:void 0},B.prototype.has=function(t){var e=this.__data__;return N?void 0!==e[t]:V.call(e,t)},B.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=N&&void 0===e?"__lodash_hash_undefined__":e,this},R.prototype.clear=function(){this.size=0,this.__data__={hash:new B,map:new(I||i),string:new B}},R.prototype.delete=function(t){var e=q(this,t).delete(t);return this.size-=e?1:0,e},R.prototype.get=function(t){return q(this,t).get(t)},R.prototype.has=function(t){return q(this,t).has(t)},R.prototype.set=function(t,e){var n=q(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};function W(t){var e=this.__data__=new i(t);this.size=e.size}W.prototype.clear=function(){this.__data__=new i,this.size=0},W.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},W.prototype.get=function(t){return this.__data__.get(t)},W.prototype.has=function(t){return this.__data__.has(t)},W.prototype.set=function(t,e){var n=this.__data__;if(n instanceof i){var r=n.__data__;if(!I||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new R(r)}return n.set(t,e),this.size=n.size,this};var D=function(){try{var t=M(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();function H(t,e,n){"__proto__"==e&&D?D(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function G(t,e,r){(void 0!==r&&!n(t[e],r)||void 0===r&&!(e in t))&&H(t,e,r)}var J=function(t,e,n){for(var r=-1,o=Object(t),i=n(t),a=i.length;a--;){var u=i[++r];if(!1===e(o[u],u,o))break}return t},K="object"==typeof exports&&exports&&!exports.nodeType&&exports,Q=K&&"object"==typeof module&&module&&!module.nodeType&&module,X=Q&&Q.exports===K?s.Buffer:void 0;X&&X.allocUnsafe;var Y=s.Uint8Array;function Z(t,e){var n,r,o=(n=t.buffer,r=new n.constructor(n.byteLength),new Y(r).set(new Y(n)),r);return new t.constructor(o,t.byteOffset,t.length)}var tt=Object.create,et=function(){function t(){}return function(e){if(!g(e))return{};if(tt)return tt(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();var nt,rt,ot=(nt=Object.getPrototypeOf,rt=Object,function(t){return nt(rt(t))}),it=Object.prototype;function at(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||it)}function ut(t){return null!=t&&"object"==typeof t}function st(t){return ut(t)&&"[object Arguments]"==b(t)}var ct=Object.prototype,lt=ct.hasOwnProperty,pt=ct.propertyIsEnumerable,ft=st(function(){return arguments}())?st:function(t){return ut(t)&&lt.call(t,"callee")&&!pt.call(t,"callee")},vt=Array.isArray,dt=9007199254740991;function ht(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=dt}function yt(t){return null!=t&&ht(t.length)&&!w(t)}var _t="object"==typeof exports&&exports&&!exports.nodeType&&exports,bt=_t&&"object"==typeof module&&module&&!module.nodeType&&module,gt=bt&&bt.exports===_t?s.Buffer:void 0,mt=(gt?gt.isBuffer:void 0)||function(){return!1},jt="[object Object]",$t=Function.prototype,Ot=Object.prototype,wt=$t.toString,xt=Ot.hasOwnProperty,Pt=wt.call(Object);var zt={};zt["[object Float32Array]"]=zt["[object Float64Array]"]=zt["[object Int8Array]"]=zt["[object Int16Array]"]=zt["[object Int32Array]"]=zt["[object Uint8Array]"]=zt["[object Uint8ClampedArray]"]=zt["[object Uint16Array]"]=zt["[object Uint32Array]"]=!0,zt["[object Arguments]"]=zt["[object Array]"]=zt["[object ArrayBuffer]"]=zt["[object Boolean]"]=zt["[object DataView]"]=zt["[object Date]"]=zt["[object Error]"]=zt["[object Function]"]=zt["[object Map]"]=zt["[object Number]"]=zt["[object Object]"]=zt["[object RegExp]"]=zt["[object Set]"]=zt["[object String]"]=zt["[object WeakMap]"]=!1;var At="object"==typeof exports&&exports&&!exports.nodeType&&exports,Tt=At&&"object"==typeof module&&module&&!module.nodeType&&module,kt=Tt&&Tt.exports===At&&a.process,Et=function(){try{var t=Tt&&Tt.require&&Tt.require("util").types;return t||kt&&kt.binding&&kt.binding("util")}catch(t){}}(),Lt=Et&&Et.isTypedArray,St=Lt?function(t){return function(e){return t(e)}}(Lt):function(t){return ut(t)&&ht(t.length)&&!!zt[b(t)]};function Ct(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}var Ft=Object.prototype.hasOwnProperty;function Mt(t,e,r){var o=t[e];Ft.call(t,e)&&n(o,r)&&(void 0!==r||e in t)||H(t,e,r)}var It=9007199254740991,Nt=/^(?:0|[1-9]\d*)$/;function Ut(t,e){var n=typeof t;return!!(e=null==e?It:e)&&("number"==n||"symbol"!=n&&Nt.test(t))&&t>-1&&t%1==0&&t<e}function Vt(t,e){var n=vt(t),r=!n&&ft(t),o=!n&&!r&&mt(t),i=!n&&!r&&!o&&St(t),a=n||r||o||i,u=a?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],s=u.length;for(var c in t)a&&("length"==c||o&&("offset"==c||"parent"==c)||i&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Ut(c,s))||u.push(c);return u}var Bt=Object.prototype.hasOwnProperty;function qt(t){if(!g(t))return function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}(t);var e=at(t),n=[];for(var r in t)("constructor"!=r||!e&&Bt.call(t,r))&&n.push(r);return n}function Rt(t){return yt(t)?Vt(t):qt(t)}function Wt(t){return function(t,e,n,r){var o=!n;n||(n={});for(var i=-1,a=e.length;++i<a;){var u=e[i],s=void 0;void 0===s&&(s=t[u]),o?H(n,u,s):Mt(n,u,s)}return n}(t,Rt(t))}function Dt(t,e,n,r,o,i,a){var u=Ct(t,n),s=Ct(e,n),c=a.get(s);if(c)G(t,n,c);else{var l,p=i?i(u,s,n+"",t,e,a):void 0,f=void 0===p;if(f){var v=vt(s),d=!v&&mt(s),h=!v&&!d&&St(s);p=s,v||d||h?vt(u)?p=u:ut(l=u)&&yt(l)?p=function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}(u):d?(f=!1,p=s.slice()):h?(f=!1,p=Z(s)):p=[]:function(t){if(!ut(t)||b(t)!=jt)return!1;var e=ot(t);if(null===e)return!0;var n=xt.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&wt.call(n)==Pt}(s)||ft(s)?(p=u,ft(u)?p=Wt(u):g(u)&&!w(u)||(p=function(t){return"function"!=typeof t.constructor||at(t)?{}:et(ot(t))}(s))):f=!1}f&&(a.set(s,p),o(p,s,r,i,a),a.delete(s)),G(t,n,p)}}function Ht(t,e,n,r,o){t!==e&&J(e,(function(i,a){if(o||(o=new W),g(i))Dt(t,e,a,n,Ht,r,o);else{var u=r?r(Ct(t,a),i,a+"",t,e,o):void 0;void 0===u&&(u=i),G(t,a,u)}}),Rt)}function Gt(t){return t}var Jt=Math.max;var Kt=D?function(t,e){return D(t,"toString",{configurable:!0,enumerable:!1,value:(n=e,function(){return n}),writable:!0});var n}:Gt,Qt=Date.now;var Xt=function(t){var e=0,n=0;return function(){var r=Qt(),o=16-(r-n);if(n=r,o>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}(Kt);function Yt(t,e){return Xt(function(t,e,n){return e=Jt(void 0===e?t.length-1:e,0),function(){for(var r=arguments,o=-1,i=Jt(r.length-e,0),a=Array(i);++o<i;)a[o]=r[e+o];o=-1;for(var u=Array(e+1);++o<e;)u[o]=r[o];return u[e]=n(a),function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}(t,this,u)}}(t,e,Gt),t+"")}var Zt,te=(Zt=function(t,e,n){Ht(t,e,n)},Yt((function(t,e){var r=-1,o=e.length,i=o>1?e[o-1]:void 0,a=o>2?e[2]:void 0;for(i=Zt.length>3&&"function"==typeof i?(o--,i):void 0,a&&function(t,e,r){if(!g(r))return!1;var o=typeof e;return!!("number"==o?yt(r)&&Ut(e,r.length):"string"==o&&e in r)&&n(r[e],t)}(e[0],e[1],a)&&(i=o<3?void 0:i,o=1),t=Object(t);++r<o;){var u=e[r];u&&Zt(t,u,r,i)}return t}))),ee={clsPrefix:"ezui-mp4",autoPlay:!0,volume:.5,width:600,height:400,disableContextmenu:!0,controls:!1,name:"mp4",loggerOptions:{name:"MP4"}};var ne=function(){function t(){}return t.init=function(n){t.collect=new e(n)},t.send=function(e,n){var r,o;null==(o=t.collect)||null==(r=o.send)||r.call(o,{action:e,logInfo:n})},t.updateParams=function(e){t.collect.updateExtendsInfo(e)},t}();function re(t,e,n){return e&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(t.prototype,e),t}function oe(t,e){return oe=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},oe(t,e)}var ie=function(e){function n(t){var r;return void 0===t&&(t={}),(r=e.call(this,te(ee,t))||this).name="Mp4Player",ne.init({url:"https://log.ys7.com/statistics.do/opensdk_ezuikit",forbidden:r.options.disableCollect,extendsInfo:{protocol:"mp4",v:"0.1.0",url:r.options.url}}),ne.send(1,{name:"constructor"}),r._videoClassName=r.options.clsPrefix+"-video",r._containerClassName=r.options.clsPrefix+"-container",r.logger.log("Mp4Player version: ",n.version),r.logger.log("Mp4Player options: ",r.options),r._volume=+(r.options.volume||0),r._render(),r._registerEvent(),r}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&oe(t,e)}(n,e);var r=n.prototype;return r.play=function(t){var e,n;return null==(e=this.logger)||e.log("[play]"),null==(n=this.event)||n.emit("play"),ne.send(50,{name:"play"}),this.$video?("string"==typeof t&&t&&(this.$video.src=t,this.options.url=t,this._pause()),this.$video.play()):Promise.resolve()},r.pause=function(){var t,e;null==(t=this.logger)||t.log("[pause]"),null==(e=this.event)||e.emit("pause"),ne.send(50,{name:"pause"}),this._pause()},r._pause=function(){this.$video&&this.playing&&this.$video.pause()},r.setVolume=function(t){var e;this.$video&&(t=+t,isNaN(t)||t>1||t<0||"number"!=typeof t?null==(e=this.logger)||e.warn("volume value "+t+" is not within 0~1!"):(this.$video.muted&&t>0?this.$video.muted=!1:0===t&&(this.$video.muted=!0),this._volume=t,this.$video.volume=t))},r._render=function(){this.$video||(this.$video=new t.Video(this.$container,this.options).$video,this.$video.classList.add(this._videoClassName),this.options.url&&(this.$video.src=this.options.url),this.$container.classList.add(this._containerClassName),this.$container.innerHTML="",this.$container.appendChild(this.$video),this.event.emit("rendered"))},r._registerEvent=function(){var t;(t=this).$video&&(t.$video.addEventListener("loadeddata",(function(e){t.event.emit("loadeddata"),t.event.emit("mediaInfo",{data:{height:e.target.videoHeight,width:e.target.videoWidth,vcodec:"",acodec:"",duration:e.target.duration}})})),t.$video.addEventListener("volumechange",(function(){t.event.emit("volumechange",{data:t.$video.volume})})),t.$video.addEventListener("seeking",(function(){t.event.emit("seeking",{data:t.$video.currentTime})})),t.$video.addEventListener("timeupdate",(function(){try{var e,n=null==(e=t.$video)?void 0:e.currentTime;t.event.emit("timeupdate",{data:n})}catch(t){}})),t.$video.addEventListener("error",(function(){var e;null==(e=t.event)||e.emit("error",{data:t.$video.error})})),["ended","abort","seeked","waiting","canplay","progress"].forEach((function(e){t.$video.addEventListener(e,(function(){t.event.emit(e)}))})))},r.destroy=function(){var t,n;ne.send(50,{name:"destroy"}),this.$video&&(this._pause(),null==(t=this.logger)||t.log("[destroy]"),null==(n=this.event)||n.emit("destroy"),this.$container&&(this.$container.classList.remove(this._containerClassName),this.$container.innerHTML="",this.$container=null),this.$video&&(this.$video=null),e.prototype.destroy.call(this))},r.getVersion=function(){return ne.send(50,{name:"getVersion"}),"0.1.0"},n.supportType=function(t){if(ne.send(50,{name:"supportType",options:t}),"mp4"===t.type)return!0;if(t.url){var e=t.url;e.startsWith("http://")||e.startsWith("https://")||(e=/^\/\//.test(e)?"http:"+e:location.origin+location.pathname+e);try{return/\.mp4$/i.test(new URL(e).pathname)}catch(t){}}return!1},re(n,[{key:"playing",get:function(){return this.$video&&!this.$video.paused}},{key:"volume",get:function(){return this._volume},set:function(t){this.setVolume(t)}},{key:"currentTime",get:function(){return this.$video.currentTime},set:function(t){this.$video.currentTime=t}},{key:"duration",get:function(){return this.$video.duration}}]),n}(t);ie.version="0.1.0",module.exports=ie;
